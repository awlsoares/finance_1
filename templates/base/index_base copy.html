{% extends 'base/base.html' %}
{% load static %}
{% block content %}
  <main id="main" class="main">

    <div class="pagetitle">
      <h1>Dashboard</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{% url 'index' %}">Home</a></li>
          <li class="breadcrumb-item active">Dashboard</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section Dashboard">
      <div class="row">


        <!-- Velocímetro % Consumo da Receita - Moderno-->
        <div class="col-xxl-4 col-md-6">
          <div id="radialBarChart"></div>
          <script>
            document.addEventListener("DOMContentLoaded", () => {
              let consumo = {{ consumo_receita|safe }};
              var options = {
                // series: [75],
                series: consumo,
                chart: {
                height: 300,
                type: 'radialBar',
                toolbar: {
                  show: true
                }
              },
              plotOptions: {
                radialBar: {
                  startAngle: -135,
                  endAngle: 225,
                  hollow: {
                    margin: 0,
                    size: '60%',
                    background: '#fff',
                    image: undefined,
                    imageOffsetX: 0,
                    imageOffsetY: 0,
                    position: 'front',
                    dropShadow: {
                      enabled: true,
                      top: 3,
                      left: 0,
                      blur: 4,
                      opacity: 0.24
                    }
                  },
                  track: {
                    background: '#fff',
                    strokeWidth: '67%',
                    margin: 0, // margin is in pixels
                    dropShadow: {
                      enabled: true,
                      top: -3,
                      left: 0,
                      blur: 4,
                      opacity: 0.35
                    }
                  },
              
                  dataLabels: {
                    show: true,
                    name: {
                      offsetY: -10,
                      show: true,
                      color: '#888',
                      fontSize: '17px'
                    },
                    value: {
                      formatter: function(val) {
                        return parseInt(val);
                      },
                      color: '#111',
                      fontSize: '36px',
                      show: true,
                    }
                  }
                }
              },
              fill: {
                type: 'gradient',
                gradient: {
                  shade: 'dark',
                  type: 'horizontal',
                  shadeIntensity: 0.5,
                  gradientToColors: ['#4CAF50', '#FFD700', '#FF0000'], // Verde, amarelo, vermelho
                  inverseColors: true,
                  opacityFrom: 1,
                  opacityTo: 1,
                  stops: [0, 75, 100]
                }
              },
              stroke: {
                lineCap: 'round'
              },
              labels: ['Despesa / Receita'],
              };

              var chart = new ApexCharts(document.querySelector("#radialBarChart"), options);
              chart.render();
            });
          </script>
        </div> <!-- End Velocímetro-->


        <!-- Donuts Despesas por Categoria -->
        <div class="col-xxl-4 col-md-6">
          <div id="donutChart"></div>
          <script>
            document.addEventListener("DOMContentLoaded", () => {
              var options = {
                series: [44, 55, 13, 33],
                chart: {
                width: 380,
                type: 'donut',
              },
              dataLabels: {
                enabled: false
              },
              responsive: [{
                breakpoint: 480,
                options: {
                  chart: {
                    width: 200
                  },
                  legend: {
                    show: false
                  }
                }
              }],
              legend: {
                position: 'right',
                offsetY: 0,
                height: 230,
        },
        // Adicionando texto no centro do donut
        annotations: {
          title: {
            text: 'Despesas por Categorias',
            offsetY: 0,
            style: {
              fontSize: '20px',
              color: '#000'
            }
          }
        }
      };

              var chart = new ApexCharts(document.querySelector("#donutChart"), options);
              chart.render();
            });
          </script>
        </div> <!-- End Donuts-->
        


        <!-- Pirâmide Despesas por Categoria -->
        <div class="col-xxl-4 col-md-6">
          <div id="piramideChart"></div>
          <script>
            document.addEventListener("DOMContentLoaded", () => {
              var options = {
                series: [
                {
                  name: "",
                  data: [200, 330, 548, 740, 880, 990, 1100, 1380],
                },
                ],
                  chart: {
                  type: 'bar',
                  height: 350,
                },
                plotOptions: {
                  bar: {
                    borderRadius: 0,
                    horizontal: true,
                    distributed: true,
                    barHeight: '80%',
                    isFunnel: true,
                  },
                },
                colors: [
                  '#F44F5E',
                  '#E55A89',
                  '#D863B1',
                  '#CA6CD8',
                  '#B57BED',
                  '#8D95EB',
                  '#62ACEA',
                  '#4BC3E6',
                ],
                dataLabels: {
                  enabled: true,
                  formatter: function (val, opt) {
                    return opt.w.globals.labels[opt.dataPointIndex] 
                  },
                  dropShadow: {
                    enabled: true,
                  },
                },
                title: {
                  text: 'Pyramid Chart',
                  align: 'middle',
                },
                xaxis: {
                  categories: ['Sweets', 'Processed Foods', 'Healthy Fats', 'Meat', 'Beans & Legumes', 'Dairy', 'Fruits & Vegetables', 'Grains'],
                },
                legend: {
                  show: false,
                },
              };

              var chart = new ApexCharts(document.querySelector("#piramideChart"), options);
              chart.render();
            });
          </script>
        </div> <!-- End Pirâmide-->


        <!-- Card Despesas Pendentes e A Vencer-->
        <div class="col-xxl-4 col-md-6">
          <div class="card info-card sales-card">
            <div class="card-body">
              <h5 class="card-title" style="text-align: center;">Total Despesas Atrasadas</h5>   
              <div style="display: inline-flexbox; text-align: center;">
                <div>
                  <i class="bi bi-emoji-frown"></i> <h6 style="color: red;">145</h6>
                </div>
              </div>

              <h5 class="card-title" style="text-align: center;">Despesas a Vencer no Mês</h5>
              <div style="display: inline-flexbox; text-align: center;">
                <div>
                  <i class="bi bi-emoji-neutral"></i> <h6 style="color: blue;">145</h6>
                </div>
              </div>

            </div>

          </div>
        </div><!-- End Card -->


         <!-- Gráfico Balanço Financeiro 2024 -->
         <div>
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Balanço Financeiro 2024</h5>

              <!-- Column Chart -->
              <div id="columnChart"></div>

              <script>
                document.addEventListener("DOMContentLoaded", () => {

                  // Dados de receita e despesa
                  let receita = {{ receitas|safe }};
                  let despesa = {{ despesas|safe }};
                  // let receita = [44, 55, 57, 56, 61, 58, 63, 60, 66, 56, 49, 112];
                  // let despesa = [-76, -85, -101, -98, -87, -105, -91, -114, -94, -44, -71, -70];

                  // Calcular o saldo
                  //let saldo = [35, 41, 36, 26, 45, 48, 52, 53, 41, 43, 28, 51]
                  let saldo = [];
                  for (let i = 0; i < receita.length; i++) {
                      saldo.push(receita[i] + despesa[i]);
                  }

                  // Definir as cores das séries
                  let cores = ['#4CAF50', '#FF0000', '#0000FF'];

                  new ApexCharts(document.querySelector("#columnChart"), {
                    series: [{
                      name: 'Receita',
                      data: receita
                    }, {
                      name: 'Despesa',
                      data: despesa
                    }, {
                      name: 'Saldo',
                      data: saldo
                    }],
                    chart: {
                      type: 'bar',
                      height: 400
                    },
                    plotOptions: {
                      bar: {
                        horizontal: false,
                        columnWidth: '55%',
                        endingShape: 'rounded'
                      },
                    },
                    dataLabels: {
                      enabled: false
                    },
                    stroke: {
                      show: true,
                      width: 2,
                      colors: ['transparent']
                    },
                    xaxis: {
                      categories: ['Jan','Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Sey', 'Out', 'Nov', 'Dez'],
                    },
                    yaxis: {
                      title: {
                        text: 'R$'
                      },
                      labels: {
                        formatter: function(val) {
                          return "R$ " + val.toFixed(2);
                        }
                      }
                    },
                    fill: {
                      opacity: 1
                    },
                    tooltip: {
                      y: {
                        formatter: function(val) {
                          return "R$ " + val.toFixed(2);
                        }
                      }
                    },
                    // Definindo cores personalizadas para as séries
                    colors: cores,
                  }).render();
                });
              </script>
              <!-- End Column Chart -->

            </div>
          </div>
        </div> <!-- End Gráfico -->


      </div>
    </section>

  </main><!-- End #main -->            
{% endblock %}